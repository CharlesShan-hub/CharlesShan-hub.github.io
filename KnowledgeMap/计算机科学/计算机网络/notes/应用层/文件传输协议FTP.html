<!doctype html>
<html style='font-size:24px !important'>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>

<link rel="stylesheet" type="text/css" href="style.css">
<link rel="stylesheet" type="text/css" href="../style.css">
<link rel="stylesheet" type="text/css" href="../../style.css">
<link rel="stylesheet" type="text/css" href="../../../style.css">
<link rel="stylesheet" type="text/css" href="../../../../style.css">
<link rel="stylesheet" type="text/css" href="../../../../../style.css"><title>文件传输协议FTP</title>
</head>
<body class='typora-export'><div class='typora-export-content'>
<div id='write'  class=''><h1 id='文件传输协议ftp'><span>文件传输协议FTP</span></h1><p><span>2022.03.16</span></p><div class='md-toc' mdtype='toc'><p class="md-toc-content" role="list"><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n0"><a class="md-toc-inner" href="#文件传输协议ftp">文件传输协议FTP</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n3"><a class="md-toc-inner" href="#ftp的工作原理">FTP的工作原理</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n15"><a class="md-toc-inner" href="#控制链接与数据连接">控制链接与数据连接</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n18"><a class="md-toc-inner" href="#控制连接">控制连接</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n21"><a class="md-toc-inner" href="#数据连接">数据连接</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n28"><a class="md-toc-inner" href="#练习">练习</a></span></p></div><h2 id='ftp的工作原理'><span>FTP的工作原理</span></h2><p><span>文件传输协议(File Transfer Protocol, FTP)是因特网上使用得最广泛的文件传输协议。FTP提供交互式的访问，允许客户指明文件的类型与格式，并允许文件具有存取权限。它屏蔽了各计算机系统的细节，因而适合于在异构网络中的任意计算机之间传送文件。</span></p><p><span>FTP提供以下功能：</span></p><p><span>①提供不同种类主机系统（硬、软件体系等都可以不同）之间的文件传输能力。</span></p><p><span>②以用户权限管理的方式提供用户对远程FTP服务器上的文件管理能力。</span></p><p><span>③以匿名FTP的方式提供公用文件共享的能力。</span></p><p><span>FTP采用客户服务器的工作方式，它使用TCP可靠的传输服务。一个FTP服务器进程可同时为多个客户进程提供服务。FTP的服务器进程由两大部分组成：一个主进程，负责接收新的请求：另外有若干从属进程，负责处理单个请求。其工作步骤如下：</span></p><p><span>① 打开熟知端口</span><strong><span>21</span></strong><span>（控制端口），使客户进程能够连接上。</span></p><p><span>② 等待客户进程发连接请求。</span></p><p><span>③ 启动从属进程来处理客户进程发来的请求。主进程与从属进程并发执行，从属进程对客户进程的请求处理完毕后即终止。</span></p><p><span>④ 回到等待状态，继续接收其他客户进程的请求。</span></p><p><span>FTP服务器必须在整个会话期间保留用户的状态信息。特别是服务器必须把指定的用户账户与控制连接联系起来，服务器必须追踪用户在远程目录树上的当前位置。</span></p><h2 id='控制链接与数据连接'><span>控制链接与数据连接</span></h2><p><span>FTP在工作时使用两个并行的TCP连接（见图6.7）：一个是</span><strong><span>控制连接（端口号21）</span></strong><span>，一个是</span><strong><span>数据连接(端口号20)</span></strong><span>。使用两个不同的端口号可使协议更加简单和更容易实现。</span></p><p><img src="resources/FTP原理.png" alt="FTP原理" style="zoom:50%;" /></p><h3 id='控制连接'><span>控制连接</span></h3><p><span>服务器监听</span><strong><span>21号端口</span></strong><span>，等待客户连接，建立在这个端口上的连接称为控制连接，控制连接用来传输控制信息（如连接请求、传送请求等），并且控制信息都以7位ASCⅡ格式传送。FTP客户发出的传送请求，通过控制连接发送给服务器端的控制进程，但控制连接并不用来传送文件。</span></p><p><span>在传输文件时还可以使用控制连接（如客户在传输中途发一个中止传输的命令），因此控制连接在整个会话期间一直保持打开状态。</span></p><h3 id='数据连接'><span>数据连接</span></h3><p><span>服务器端的控制进程在接收到FTP客户发来的文件传输请求后，就创建“数据传送进程”和“数据连接”。数据连接用来连接客户端和服务器端的数据传送进程，数据传送进程实际完成文件的传送，在传送完毕后关闭“数据传送连接”并结束运行。</span></p><p><span>数据连接有两种传输模式：</span><strong><span>主动模式PORT</span></strong><span>和</span><strong><span>被动模式PASV</span></strong><span>。</span></p><p><span>PORT模式的工作原理：客户端连接到服务器的21端口，登录成功后要读取数据时，客户端随机开放一个端口，并发送命令告知服务器，服务器收到PORT命令和端口号后，通过20端口和客户端开放的端口连接，发送数据。</span></p><p><span>PASV模式的不同点是，客户端要读取数据时，发送PASV命令到服务器，服务器在本地随机开放一个端口，并告知客户端，客户端再连接到服务器开放的端口进行数据传输。</span></p><p><span>【小结：主动模式是客户端建一个端口，告诉服务器；被动模式是服务器建一个端口，告诉客户端】</span></p><p><span>可见，是用PORT模式还是PASV模式，选择权在客户端。简单概括为，主动模式传送数据是“服务器”连接到“客户端”的端口；被动模式传送数据是“客户端”连接到“服务器”的端口。因为FTP使用了一个分离的控制连接，所以也称</span><strong><u><span>FTP的控制信息是带外(Out-of-band)传送的</span></u></strong><span>。使用FTP时，若要修改服务器上的文件，则需要先将此文件传送到本地主机，然后再将修改后的文件副本传送到原服务器，来回传送耗费很多时间。网络文件系统(NFS)采用另一种思路，它允许进程打开一个远程文件，并能在该文件的某个特定位置开始读写数据。这样，NFS可使用户复制一个大文件中的一个很小的片段，而不需要复制整个大文件。</span></p><h2 id='练习'><span>练习</span></h2><ul><li><p><span>匿名FTP访问通常使用()作为用户名。</span></p><p><span>A.guest</span></p><p><span>B.E-mail地址</span></p><p><span>C.anonymous</span></p><p><span>D.主机id</span></p><p><span>【答案】：C</span></p></li></ul><p>&nbsp;</p></div></div>
</body>
</html>
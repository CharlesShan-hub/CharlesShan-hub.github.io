<!doctype html>
<html style='font-size:22px !important'>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>

<link rel="stylesheet" type="text/css" href="style.css">
<link rel="stylesheet" type="text/css" href="../style.css">
<link rel="stylesheet" type="text/css" href="../../style.css">
<link rel="stylesheet" type="text/css" href="../../../style.css">
<link rel="stylesheet" type="text/css" href="../../../../style.css">
<link rel="stylesheet" type="text/css" href="../../../../../style.css"><title>文件系统</title>
</head>
<body class='typora-export'><div class='typora-export-content'>
<div id='write'  class=''><h1 id='文件系统'><span>文件系统</span></h1><p><span>2022.09.21</span></p><div class='md-toc' mdtype='toc'><p class="md-toc-content" role="list"><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n0"><a class="md-toc-inner" style="cursor: pointer;" href="#文件系统">文件系统</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n4"><a class="md-toc-inner" style="cursor: pointer;" href="#文件系统结构">文件系统结构</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n8"><a class="md-toc-inner" style="cursor: pointer;" href="#文件系统分布">文件系统分布</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n72"><a class="md-toc-inner" style="cursor: pointer;" href="#外存管理">外存管理</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n138"><a class="md-toc-inner" style="cursor: pointer;" href="#习题">习题</a></span></p></div><h2 id='文件系统结构'><span>文件系统结构</span></h2><ol><li><span>IO控制</span></li><li><span>基本文件系统</span></li><li><span>文件组织模块：eg逻辑块、物理块</span></li><li><span>逻辑文件系统：eg元数据（不是实际数据）</span></li></ol><h2 id='文件系统分布'><span>文件系统分布</span></h2><ol><li><p><span>文件系统在</span><strong><span>磁盘</span></strong><span>中的结构</span></p><p><img src="resources/磁盘.png" referrerpolicy="no-referrer" alt="image-20220921174721258"></p><ol><li><strong><span>主引导记录</span></strong><span>（Master Boot Record, MBR），位于磁盘的0号扇区，用来引导计算机，MBR后面是分区表，该表给出每个分区的起始和结束地址。表中的一个分区被标记为活动分区，当计算机启动时，BIOS 读入并执行 MBR。MBR 做的第一件事是确定活动分区，读入它的第一块，即引1导块。</span></li><li><strong><span>引导块</span></strong><span>（boot block)，MBR 执行引导块中的程序后，该程序负责启动该分区中的操作系统。为统一起见，每个分区都从一个引导块开始，即使它不含有一个可启动的操作系统，也不排除以后会在该分区安装一个操作系统。Windows 系统称之为分区引导扇区。除了从引导块开始，磁盘分区的布局是随着文件系统的不同而变化的。文件系统经常包含有如上图所列的一些项目。</span></li><li><strong><span>超级块</span></strong><span>（super block），包含文件系统的所有关键信息，在计算机启动时，或者在该文件系统首次使用时，超级块会被载入内存。超级块中的典型信息包括分区的块的数量、块的大小、空闲块的数量和指针、空闲的 FCB 数量和 FCB 指针等。</span></li><li><span>文件系统中</span><strong><span>空闲块的信息</span></strong><span>，可以使用</span><strong><span>位示图或指针链接</span></strong><span>的形式给出。后面也许跟的是一组i结点（</span><strong><span>i结点区</span></strong><span>），每个文件对应一个结点，i结点说明了文件的方方面面。接着可能是</span><strong><span>根目录</span></strong><span>，它存放文件系统目录树的根部。最后，磁盘的其他部分存放了其他所有的目录和文件。</span></li></ol></li><li><p><span>文件系統在</span><strong><span>内存</span></strong><span>中的结构</span></p><p><span>内存中的信息用于管理文件系统并通过</span><strong><span>缓存</span></strong><span>来提高性能。这些数据在安装文件系统时被加载，在文件系统操作期间被更新，在卸载时被丢弃。这些结构的类型可能包括：</span></p><p><span>1）内存中的安装表(mount table），包含每个已安装文件系统分区的有关信息。</span>
<span>2）内存中的目录结构的缓存包含最近访问目录的信息。对安装分区的目录，它可以包括个指向分区表的指针。</span>
<span>3）【</span><strong><span>系统打开文件表</span></strong><span>】（整个系统只有一张）整个系统的打开文件表，包含每个打开文件的 FCB 副本及其他信息。</span>
<span>4）【</span><strong><span>进程打开文件表</span></strong><span>】（包含在PCB中）每个进程的打开文件表，包含一个指向整个系统的打开文件表中的适当条目的指针，以及其他信息</span></p><p><span>为了创建新的文件，应用程序调用逻辑文件系统。逻辑文件系统知道目录结构的格式，它将为文件分配一个新的 FCB。然后，系统将相应的目录读入内存，使用新的文件名和 FCB 进行更新，并将它写回磁盘。</span></p><p><span>一旦文件被创建，它就能用于 IO。不过，首先要打开文件。系统调用open0将文件名传递给逻辑文件系统。调用open0首先搜索整个系统的打开文件表，以确定这个文件是否已被其他进程使用。如果己被使用，则在单个进程的打开文件表中创建一个条目，让其指向现有整个系统的打开文件表的相应条目。该算法在文件己打开时，能节省大量开销。如果这个文件尚未打开，则根据给定文件名来搜索目录结构。部分目录结构通常缓存在内存中，以加快目录操作。找到文件后，它的 FCB 会会复制到整个系统的打开文件表中。该表不但存储FCB，而且跟踪打开该文件的进程的数量。然后，在单个进程的打开文件表中创建一个条目，并且通过指针将整个系统打开文件表的条目与其他域(如文件当前位置的指针和文件访问模式等）相连。调用open0返回的是一个指向单个进程的打开文件表中的适当条目的指针。以后，所有文件操作都通过该指针执行。一旦文件被打开，内核就不再使用文件名来访问文件，而使用文件描述符(Windows 称之为文件句柄）。</span></p><p><span>当进程关闭一个文件时，就会州除单个进程打开文件表中的相应条目，整个系统的打开文件表的文件打开数量也会递减。当所有打开某个文件的用户都关闭该文件后，任何更新的元数据将复制到磁盘的目录结构中，并且整个系统的打开文件表的对应条目也会被删除。</span></p><p><img src="resources/在内存中.png" referrerpolicy="no-referrer" alt="image-20220921194144855"></p></li></ol><h2 id='外存管理'><span>外存管理</span></h2><ol><li><p><span>逻辑卷与物理盘的关系</span></p><p><img src="resources/逻辑卷与物理盘的关系.png" referrerpolicy="no-referrer" alt="image-20220921194411879"></p></li><li><p><span>空闲表法</span></p><p><img src="resources/空闲表法.png" referrerpolicy="no-referrer" alt="image-20220921194445773"></p></li><li><p><span>空闲链表法</span></p><ol><li><span>空闲盘块链：把空闲盘块拉成一条链，需要空间时依次分配。</span></li><li><span>空闲盘区链：把空闲盘区（盘区包含多个盘块）拉成一条链，需要空间时依次分配。</span></li></ol></li><li><p><span>位示图法</span></p><p><span>0表示空闲，1表示已分配</span></p><p><span>⚠️注意下标从1开始⚠️</span></p><p><img src="resources/位示图.png" referrerpolicy="no-referrer" alt="image-20220921194743492"></p></li><li><p><span>成组链接法</span></p><p><img src="resources/成组链接法.png" referrerpolicy="no-referrer" alt="image-20220921194838224"></p><h2 id='虚拟文件系统'><span>虚拟文件系统</span></h2><p><img src="resources/虚拟文件系统.png" referrerpolicy="no-referrer" alt="image-20220921195702771"></p></li></ol><ol><li><span>VFS：虚拟文件系统</span></li><li><span>要求下层具体文件系统统一接口</span></li><li><span>VFS会创建VNode，统一代表多种多样的文件索引结点</span></li></ol><h2 id='习题'><span>习题</span></h2><ol><li><p><span>从用户的观点看，操作系统中引入文件系统的目的是( ）。</span>
<span>A.保护用户数据</span>
<span>B.实现对文件的按名存取</span>
<span>C.实现虛拟存储</span>
<span>D.保存用户和系统文档及数据</span></p><p><span>【答案】：B</span></p></li><li><p><span>UNIX 操作系统中，文件的索引结构放在（ ）。</span>
<span>A.超级块</span>
<span>B.索引结点</span>
<span>C.目录项</span>
<span>D.空闲块</span></p><p><span>【答案】：A-&gt;B</span></p></li><li><p><span>位示图可用于( ）</span>
<span>A.文件目录的查找</span>
<span>B.磁盘空间的管理</span>
<span>C.主存空问的管理</span>
<span>D.文件的保密</span></p><p><span>【答案】：B</span></p></li><li><p><span>文件的存储空问管理实质上是对（ ）的组织和管理</span>
<span>A. 文件目录</span>
<span>B. 外存已占用区域</span>
<span>C. 外存空闲区</span>
<span>D. 文件控制块</span></p><p><span>【答案】：B-&gt;C</span></p></li><li><p><span>若用8个字（字长32位）组成的位示图管理内存，假定用户归还一个块号为 100的内存块时，它对应位示图的位置为（）。</span>
<span>A. 宇号为3，位号为5</span>
<span>B. 字号为4，位号为4</span>
<span>C. 宇号为3，位号为4</span>
<span>D. 字号为4，位号为5</span></p><p><span>【答案】：32bit代表32块。100/32=3...4，B</span></p></li><li><p><span>下列选项中，（）不是Linux 实现虛拟文件系统VFS 所定义的对象类型。</span>
<span>A. 超級块(superblock）对象</span>
<span>B. 目录项（inode）对象</span>
<span>C. 文件（file）对象</span>
<span>D. 数据（data）对象</span></p><p><span>【答案】：D</span></p></li><li><p><strong><span>【2015 统考真题】</span></strong><span>文件系统用位图法表示磁盘空问的分配情况，位图存于磁盘的 32~127号块中，每个盘块占 1024B，盘块和块内字节均从0开始编号。假设要释放的盘块号为409612，则位图中要修改的位所在的盘块号和块内宇节序号分别是（）。</span>
<span>A. 81,1</span>
<span>B. 81,2</span>
<span>C. 82,1</span>
<span>D. 82,2</span></p><p><span>【答案】：409612/1024=400...12。400/8=50，50+32-1=81，80+1=82，C</span></p></li><li><p><strong><span>【2019 统考真题】</span></strong><span>下列选项中，可用于文件系统管理空闲磁盘块的数据结构是（）。</span>
<span>I.位图</span>
<span>II.索引结点</span>
<span>III.空闲磁盘块链</span>
<span>IV.文件分配表 (FAT)</span>
<span>A. 仅I、II</span>
<span>B. 仅I、III、IV</span>
<span>C. 仅I、III</span>
<span>D. 仅II、III、IV</span></p><p><span>【答案】：C -&gt; B. 文件分配表（FAT）的表项与物理磁盘块一一对应，并且可以用一个特殊数字 -1表示文件的最后一块，用 -2 表示这个磁盘块是空闲的，因此文件分配表（FAT）不仅记录了文件中各个块的先后链接关系，同时还标记了空闲的磁盘块，操作系统可以通过FAT对文件存储空间进行管理，即 IV 正确。</span></p></li></ol></div></div>
</body>
</html>
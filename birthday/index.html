<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>生日天气祝福</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF6B8B',
                        secondary: '#4A90E2',
                        accent: '#FFD166',
                        dark: '#2C3E50',
                        light: '#F7F9FC'
                    },
                    fontFamily: {
                        sans: ['Poppins', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .card-shadow {
                box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.03);
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gradient-to-br from-light to-blue-50 min-h-screen flex flex-col">
    <header class="bg-white/80 backdrop-blur-md shadow-sm py-6 px-4 md:px-8 sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-primary text-shadow">
                <i class="fa fa-sun-o mr-2"></i>生日天气祝福
            </h1>
            <div class="hidden md:flex items-center space-x-4">
                <button id="themeToggle" class="p-2 rounded-full hover:bg-gray-100 transition-colors">
                    <i class="fa fa-moon-o text-dark"></i>
                </button>
            </div>
        </div>
    </header>

    <main class="flex-grow container mx-auto px-4 md:px-8 py-8">
        <section class="max-w-4xl mx-auto">
            <!-- 生日祝福卡片 -->
            <div class="bg-white rounded-2xl p-6 md:p-8 mb-8 card-shadow transform transition-all hover:scale-[1.01]">
                <div class="text-center mb-6">
                    <h2 class="text-[clamp(1.2rem,2vw,1.8rem)] font-semibold text-dark mb-2">特别的日子，特别的祝福</h2>
                    <p class="text-gray-600">愿今天的天气如同你的心情一样美好</p>
                </div>
                <div class="flex justify-center">
                    <div class="relative w-40 h-40 md:w-48 md:h-48">
                        <div class="absolute inset-0 bg-primary/10 rounded-full animate-pulse"></div>
                        <div class="absolute inset-2 bg-white rounded-full flex items-center justify-center">
                            <i class="fa fa-gift text-5xl md:text-6xl text-primary"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 天气查询 -->
            <div class="bg-white rounded-2xl p-6 md:p-8 mb-8 card-shadow">
                <h2 class="text-[clamp(1.2rem,2vw,1.8rem)] font-semibold text-dark mb-6 text-center">查询天气</h2>
                <!-- 地图容器 -->
                <div id="mapContainer" class="w-full h-64 bg-gray-100 rounded-lg mb-6 overflow-hidden"></div>
                <div class="text-center mb-4">
                    <p id="locationInfo" class="text-gray-600">正在获取您的位置...</p>
                </div>

                <!-- 天气结果 -->
                <div id="weatherResult" class="hidden">
                    <div class="flex flex-col md:flex-row gap-6 items-center">
                        <div class="text-center md:text-left">
                            <h3 id="cityName" class="text-2xl font-bold text-dark"></h3>
                            <p id="weatherDescription" class="text-gray-600 mt-1"></p>
                            <div class="mt-4 flex items-center justify-center md:justify-start">
                                <span id="temperature" class="text-5xl font-bold text-primary"></span>
                                <span class="text-2xl text-gray-500 ml-1">°C</span>
                            </div>
                        </div>
                        <div class="w-24 h-24">
                            <img id="weatherIcon" src="" alt="天气图标" class="w-full h-full object-contain">
                        </div>
                        <div class="grid grid-cols-2 gap-4 w-full md:w-auto">
                            <div class="bg-gray-50 p-3 rounded-lg text-center">
                                <p class="text-gray-500 text-sm">湿度</p>
                                <p id="humidity" class="text-lg font-medium text-dark"></p>
                            </div>
                            <div class="bg-gray-50 p-3 rounded-lg text-center">
                                <p class="text-gray-500 text-sm">风速</p>
                                <p id="windSpeed" class="text-lg font-medium text-dark"></p>
                            </div>
                            <div class="bg-gray-50 p-3 rounded-lg text-center">
                                <p class="text-gray-500 text-sm">气压</p>
                                <p id="pressure" class="text-lg font-medium text-dark"></p>
                            </div>
                            <div class="bg-gray-50 p-3 rounded-lg text-center">
                                <p class="text-gray-500 text-sm">能见度</p>
                                <p id="visibility" class="text-lg font-medium text-dark"></p>
                            </div>
                        </div>
                    </div>

                    <!-- 温度图表 -->
                    <div class="mt-8">
                        <h4 class="text-lg font-medium text-dark mb-4">未来5天温度趋势</h4>
                        <div class="h-64 bg-gray-50 rounded-lg p-4">
                            <canvas id="temperatureChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- 加载状态 -->
                <div id="loading" class="hidden flex flex-col items-center justify-center py-8">
                    <div class="w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin"></div>
                    <p class="mt-4 text-gray-600">正在获取天气信息...</p>
                </div>

                <!-- 错误提示 -->
                <div id="error" class="hidden bg-red-50 border border-red-100 rounded-lg p-4 text-red-600"></div>
            </div>

            <!-- 生日寄语 -->
            <div class="bg-gradient-to-r from-primary/10 to-secondary/10 rounded-2xl p-6 md:p-8 card-shadow text-center">
                <h2 class="text-[clamp(1.2rem,2vw,1.8rem)] font-semibold text-dark mb-4">生日寄语</h2>
                <p class="text-gray-700 italic mb-6">
                    "愿你的每一天都充满阳光，每一刻都洋溢着幸福。不管今天是晴天还是雨天，你都是我心中最明亮的存在。"
                </p>
                <button id="confettiBtn" class="bg-accent hover:bg-accent/90 text-dark font-medium px-6 py-3 rounded-lg transition-colors flex items-center justify-center mx-auto">
                    <i class="fa fa-star mr-2"></i> 点击撒花
                </button>
            </div>
        </section>
    </main>

    <footer class="bg-dark text-white py-6 px-4 md:px-8">
        <div class="container mx-auto text-center">
            <p class="text-gray-400 text-sm">
                特别的生日礼物 &copy; 2025
            </p>
        </div>
    </footer>

    <script>
        // API密钥（注意：实际部署时应使用后端代理或安全存储）
        const API_KEY = 'YOUR_API_KEY';
        const BASE_URL = 'https://api.openweathermap.org/data/2.5';

        // DOM元素
        const weatherForm = document.getElementById('weatherForm');
        const cityInput = document.getElementById('cityInput');
        const weatherResult = document.getElementById('weatherResult');
        const loading = document.getElementById('loading');
        const error = document.getElementById('error');
        const cityName = document.getElementById('cityName');
        const weatherDescription = document.getElementById('weatherDescription');
        const temperature = document.getElementById('temperature');
        const weatherIcon = document.getElementById('weatherIcon');
        const humidity = document.getElementById('humidity');
        const windSpeed = document.getElementById('windSpeed');
        const pressure = document.getElementById('pressure');
        const visibility = document.getElementById('visibility');
        const themeToggle = document.getElementById('themeToggle');
        const confettiBtn = document.getElementById('confettiBtn');

        // 温度图表
        let temperatureChart = null;

        // 提交表单事件
        weatherForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const city = cityInput.value.trim();
            if (city) {
                await getWeatherData(city);
            }
        });

        // 获取天气数据
        async function getWeatherData(city) {
            try {
                // 显示加载状态
                weatherResult.classList.add('hidden');
                error.classList.add('hidden');
                loading.classList.remove('hidden');

                // 获取当前天气
                const currentWeatherUrl = `${BASE_URL}/weather?q=${city}&appid=${API_KEY}&units=metric&lang=zh_cn`;
                const currentResponse = await fetch(currentWeatherUrl);
                if (!currentResponse.ok) {
                    throw new Error('无法获取当前天气数据，请检查城市名称是否正确');
                }
                const currentData = await currentResponse.json();

                // 获取5天预报
                const forecastUrl = `${BASE_URL}/forecast?q=${city}&appid=${API_KEY}&units=metric&lang=zh_cn`;
                const forecastResponse = await fetch(forecastUrl);
                if (!forecastResponse.ok) {
                    throw new Error('无法获取天气预报数据');
                }
                const forecastData = await forecastResponse.json();

                // 显示天气数据
                displayWeatherData(currentData, forecastData);

            } catch (err) {
                // 显示错误
                error.textContent = err.message;
                error.classList.remove('hidden');
            } finally {
                // 隐藏加载状态
                loading.classList.add('hidden');
            }
        }

        // 显示天气数据
        function displayWeatherData(currentData, forecastData) {
            // 当前天气
            cityName.textContent = `${currentData.name}, ${currentData.sys.country}`;
            weatherDescription.textContent = currentData.weather[0].description;
            temperature.textContent = Math.round(currentData.main.temp);
            weatherIcon.src = `https://openweathermap.org/img/wn/${currentData.weather[0].icon}@2x.png`;
            weatherIcon.alt = currentData.weather[0].description;
            humidity.textContent = `${currentData.main.humidity}%`;
            windSpeed.textContent = `${currentData.wind.speed} m/s`;
            pressure.textContent = `${currentData.main.pressure} hPa`;
            visibility.textContent = `${(currentData.visibility / 1000).toFixed(1)} km`;

            // 处理5天预报数据（每天取一个时间点）
            const dailyForecasts = [];
            const today = new Date().toDateString();

            for (const item of forecastData.list) {
                const date = new Date(item.dt * 1000);
                // 跳过今天的数据
                if (date.toDateString() === today) continue;
                // 只取每天12点的数据
                if (date.getHours() === 12) {
                    dailyForecasts.push({
                        date: date.toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' }),
                        temp: item.main.temp,
                        icon: item.weather[0].icon
                    });
                    // 只取5天
                    if (dailyForecasts.length === 5) break;
                }
            }

            // 绘制温度图表
            drawTemperatureChart(dailyForecasts);

            // 显示结果
            weatherResult.classList.remove('hidden');
        }

        // 绘制温度图表
        function drawTemperatureChart(data) {
            const ctx = document.getElementById('temperatureChart').getContext('2d');

            // 销毁现有图表
            if (temperatureChart) {
                temperatureChart.destroy();
            }

            // 创建新图表
            temperatureChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(item => item.date),
                    datasets: [{
                        label: '温度 (°C)',
                        data: data.map(item => item.temp),
                        borderColor: '#FF6B8B',
                        backgroundColor: 'rgba(255, 107, 139, 0.1)',
                        borderWidth: 3,
                        pointBackgroundColor: '#FF6B8B',
                        pointRadius: 5,
                        pointHoverRadius: 7,
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.9)',
                            titleColor: '#2C3E50',
                            bodyColor: '#2C3E50',
                            borderColor: 'rgba(0, 0, 0, 0.1)',
                            borderWidth: 1,
                            padding: 10,
                            boxPadding: 5,
                            usePointStyle: true,
                            callbacks: {
                                label: function(context) {
                                    return `${context.parsed.y} °C`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // 主题切换
        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            const icon = themeToggle.querySelector('i');
            const cards = document.querySelectorAll('.bg-white, .bg-gray-50, .bg-gray-800, .bg-gray-700');
            const textElements = document.querySelectorAll('.text-dark, .text-gray-600, .text-gray-700, .text-gray-500, .text-white, .text-gray-200, .text-gray-300');
            const weatherResult = document.getElementById('weatherResult');
            const errorElement = document.getElementById('error');
            const loadingElement = document.getElementById('loading');

            if (document.body.classList.contains('dark-mode')) {
                // 切换到暗黑模式
                icon.classList.remove('fa-moon-o');
                icon.classList.add('fa-sun-o');
                document.body.classList.remove('from-light', 'to-blue-50');
                document.body.classList.add('from-dark', 'to-gray-800');

                // 更新卡片颜色
                cards.forEach(card => {
                    card.classList.remove('bg-white', 'bg-gray-50');
                    card.classList.add('bg-gray-800', 'bg-gray-700');
                });

                // 更新文字颜色
                textElements.forEach(text => {
                    text.classList.remove('text-dark', 'text-gray-600', 'text-gray-700', 'text-gray-500');
                    text.classList.add('text-white', 'text-gray-200', 'text-gray-300');
                });

                // 更新特殊元素
                if (weatherResult) weatherResult.classList.add('text-white');
                if (errorElement) {
                    errorElement.classList.remove('bg-red-50', 'border-red-100', 'text-red-600');
                    errorElement.classList.add('bg-red-900', 'border-red-800', 'text-red-200');
                }
                if (loadingElement) {
                    loadingElement.classList.add('bg-gray-800');
                    loadingElement.querySelector('p').classList.remove('text-gray-600');
                    loadingElement.querySelector('p').classList.add('text-gray-300');
                }
                // 更新header背景
                const header = document.querySelector('header');
                header.classList.remove('bg-white/80');
                header.classList.add('bg-gray-900/80');
                
                // 更新header文字颜色
                const headerTitle = header.querySelector('h1');
                headerTitle.classList.remove('text-primary');
                headerTitle.classList.add('text-white');
                
                // 更新主题切换按钮
                themeToggle.classList.remove('bg-white');
                themeToggle.classList.add('bg-gray-700');
                icon.classList.remove('text-dark');
                icon.classList.add('text-white');

            } else {
                // 切换到亮色模式
                icon.classList.remove('fa-sun-o');
                icon.classList.add('fa-moon-o');
                document.body.classList.remove('from-dark', 'to-gray-800');
                document.body.classList.add('from-light', 'to-blue-50');

                // 更新卡片颜色
                cards.forEach(card => {
                    card.classList.remove('bg-gray-800', 'bg-gray-700');
                    card.classList.add('bg-white', 'bg-gray-50');
                });

                // 更新文字颜色
                textElements.forEach(text => {
                    text.classList.remove('text-white', 'text-gray-200', 'text-gray-300');
                    text.classList.add('text-dark', 'text-gray-600', 'text-gray-700', 'text-gray-500');
                });

                // 更新特殊元素
                if (weatherResult) weatherResult.classList.remove('text-white');
                if (errorElement) {
                    errorElement.classList.remove('bg-red-900', 'border-red-800', 'text-red-200');
                    errorElement.classList.add('bg-red-50', 'border-red-100', 'text-red-600');
                }
                if (loadingElement) {
                    loadingElement.classList.remove('bg-gray-800');
                    loadingElement.querySelector('p').classList.remove('text-gray-300');
                    loadingElement.querySelector('p').classList.add('text-gray-600');
                }

                // 更新header背景
                const header = document.querySelector('header');
                header.classList.remove('bg-gray-900/80');
                header.classList.add('bg-white/80');
                
                // 更新header文字颜色
                const headerTitle = header.querySelector('h1');
                headerTitle.classList.remove('text-white');
                headerTitle.classList.add('text-primary');
                
                // 更新主题切换按钮
                themeToggle.classList.remove('bg-gray-700');
                themeToggle.classList.add('bg-white');
                icon.classList.remove('text-white');
                icon.classList.add('text-dark');
                icon.classList.remove('fa-sun-o');
                icon.classList.add('fa-moon-o');
                document.body.classList.remove('from-dark', 'to-gray-800');
                document.body.classList.add('from-light', 'to-blue-50');

                // 恢复卡片颜色
                cards.forEach(card => {
                    card.classList.remove('bg-gray-800', 'bg-gray-700');
                    card.classList.add('bg-white', 'bg-gray-50');
                });

                // 恢复文字颜色
                textElements.forEach(text => {
                    text.classList.remove('text-white', 'text-gray-200', 'text-gray-300');
                    text.classList.add('text-dark', 'text-gray-600', 'text-gray-700', 'text-gray-500');
                });

                // 恢复特殊元素
                if (weatherResult) weatherResult.classList.remove('text-white');
                if (errorElement) {
                    errorElement.classList.remove('bg-red-900', 'border-red-800', 'text-red-200');
                    errorElement.classList.add('bg-red-50', 'border-red-100', 'text-red-600');
                }
                if (loadingElement) {
                    loadingElement.classList.remove('bg-gray-800');
                    loadingElement.querySelector('p').classList.remove('text-gray-300');
                    loadingElement.querySelector('p').classList.add('text-gray-600');
                }
            }
        });

        // 撒花效果
        confettiBtn.addEventListener('click', () => {
            // 简单的撒花效果
            const colors = ['#FF6B8B', '#4A90E2', '#FFD166', '#06D6A0', '#118AB2', '#073B4C'];
            const confettiCount = 100;
            const container = document.body;

            for (let i = 0; i < confettiCount; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'fixed';
                confetti.style.width = `${Math.random() * 10 + 5}px`;
                confetti.style.height = `${Math.random() * 10 + 5}px`;
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                confetti.style.position = 'fixed';
                confetti.style.top = '-20px';
                confetti.style.left = `${Math.random() * 100}vw`;
                confetti.style.opacity = Math.random() * 0.5 + 0.5;
                confetti.style.animation = `falling ${Math.random() * 3 + 2}s linear forwards`;
                confetti.style.zIndex = '1000';
                container.appendChild(confetti);

                // 动画结束后移除元素
                setTimeout(() => {
                    confetti.remove();
                }, 5000);
            }

            // 添加动画样式
            const style = document.createElement('style');
            style.textContent = `
                @keyframes falling {
                    0% {
                        transform: translateY(0) rotate(0deg);
                    }
                    100% {
                        transform: translateY(100vh) rotate(360deg);
                    }
                }
            `;
            document.head.appendChild(style);
        });
    </script>
</body>
</html>